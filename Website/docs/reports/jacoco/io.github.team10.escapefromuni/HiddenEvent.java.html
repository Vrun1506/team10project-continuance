<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>HiddenEvent.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">core</a> &gt; <a href="index.source.html" class="el_package">io.github.team10.escapefromuni</a> &gt; <span class="el_source">HiddenEvent.java</span></div><h1>HiddenEvent.java</h1><pre class="source lang-java linenums">package io.github.team10.escapefromuni;

import com.badlogic.gdx.graphics.Color;
import com.badlogic.gdx.graphics.Texture;
import com.badlogic.gdx.graphics.g2d.GlyphLayout;
import com.badlogic.gdx.graphics.g2d.Sprite;
import com.badlogic.gdx.math.Vector2;
import com.badlogic.gdx.utils.Disposable;

/**
 * NEW CLASS
 * Was originally 'EventLongboi' from the original project, which was the original hidden event.
 * Since been changed to 'HiddenEvent' to accommodate the need for multiple hidden events.
 * Not much has been changed from the original class, other than it takes an enum that controls the sprite, texts and effects.
 */
public class HiddenEvent extends Event implements Disposable {

    private final HiddenEventType type;
<span class="fc" id="L19">    public boolean hidden = true;</span>
    private final Texture hidden_texture;
    private final Texture texture;

    public Sprite sprite;

    private final Texture speech_panel_texture;
    private final Sprite speech_panel_sprite;

    /**
     * Initialises a HiddenEvent object.
     * @param type a HiddenEventType enum value.
     * @param player the current Player object.
     * @param game the current EscapeGame object.
     */
    public HiddenEvent(HiddenEventType type, Player player, EscapeGame game) {
<span class="fc" id="L35">        super(EventType.HIDDEN, player, game);</span>
<span class="fc" id="L36">        this.type = type;</span>
<span class="fc" id="L37">        texture = new Texture(type.getTexturePath());</span>
<span class="fc" id="L38">        hidden_texture = new Texture(type.getHiddenTexturePath());</span>
<span class="fc" id="L39">        speech_panel_texture = new Texture(&quot;UIWideBottomPanel.png&quot;);</span>
<span class="fc" id="L40">        speech_panel_sprite = new Sprite(speech_panel_texture);</span>
<span class="fc" id="L41">        speech_panel_sprite.setSize(1200f, 240f);</span>
<span class="fc" id="L42">    }</span>

    @Override
    public void startEvent() {
<span class="pc bpc" id="L46" title="1 of 2 branches missed.">        if (eventFinished) return;</span>
<span class="fc" id="L47">        super.startEvent();</span>

<span class="fc" id="L49">        sprite = new Sprite(hidden_texture);</span>
<span class="fc" id="L50">        sprite.setSize(2f, 2f);</span>
<span class="fc" id="L51">        sprite.setPosition(8f, 3f);</span>
<span class="fc" id="L52">        AudioManager.getInstance().playEventSound(EventType.HIDDEN);</span>
<span class="fc" id="L53">    }</span>

    @Override
    public void endEvent() {
<span class="pc bpc" id="L57" title="1 of 4 branches missed.">        if (!eventFinished &amp;&amp; !hidden){</span>
<span class="fc" id="L58">            eventFinished = true;</span>

            // Dispose called here manually in logic, but we also need a public dispose method for tests/cleanup
<span class="fc" id="L61">            texture.dispose();</span>
<span class="fc" id="L62">            hidden_texture.dispose();</span>
        }
<span class="fc" id="L64">    }</span>

    @Override
    public void update(float delta) {
        // Check every frame if player is close enough to reveal.
<span class="fc bfc" id="L69" title="All 2 branches covered.">        if (hidden) {</span>
<span class="fc" id="L70">            float playerDist = getPlayerDist();</span>
<span class="fc bfc" id="L71" title="All 2 branches covered.">            if (playerDist &lt; 3f) {</span>
<span class="fc" id="L72">                hidden = false;</span>
<span class="fc" id="L73">                sprite = new Sprite(texture);</span>
<span class="fc" id="L74">                sprite.setSize(2f, 2f);</span>
<span class="fc" id="L75">                sprite.setPosition(8f, 3f);</span>
<span class="fc" id="L76">                type.doThing(player, game);</span>
            }
        }
<span class="fc" id="L79">    }</span>

    /**
     * Calculates the distance between the center of the player and the sprite.
     * @return The distance between the player and the sprite.
     */
    private float getPlayerDist()
    {
<span class="fc" id="L87">        Vector2 playerPos = player.getCenter();</span>
<span class="fc" id="L88">        float spriteX = sprite.getX() + sprite.getWidth() / 2f;</span>
<span class="fc" id="L89">        float spriteY = sprite.getY() + sprite.getHeight() / 2f;</span>
<span class="fc" id="L90">        Vector2 longboiCenter = new Vector2(spriteX, spriteY);</span>
<span class="fc" id="L91">        return longboiCenter.dst(playerPos);</span>
    }

    @Override
    public void draw() {
<span class="nc bnc" id="L96" title="All 2 branches missed.">        if (eventFinished) return;</span>
<span class="nc" id="L97">        sprite.draw(game.batch);</span>
<span class="nc" id="L98">    }</span>

    @Override
    public void drawUI() {
<span class="nc bnc" id="L102" title="All 2 branches missed.">        if (eventFinished) return;</span>

<span class="nc bnc" id="L104" title="All 2 branches missed.">        if (!hidden)</span>
        {
<span class="nc" id="L106">            float uiWidth = game.uiViewport.getWorldWidth();</span>

<span class="nc" id="L108">            float panelY = 150f;</span>
<span class="nc" id="L109">            float panelX = uiWidth / 2f;</span>
<span class="nc" id="L110">            speech_panel_sprite.setCenter(panelX, panelY);</span>
<span class="nc" id="L111">            speech_panel_sprite.draw(game.batch);</span>

<span class="nc" id="L113">            String message = type.getMessage();</span>

<span class="nc" id="L115">            GlyphLayout layout = new GlyphLayout(game.font, message);</span>
<span class="nc" id="L116">            float textWidth = layout.width;</span>
<span class="nc" id="L117">            float textHeight = layout.height;</span>
<span class="nc" id="L118">            float textX = (uiWidth - textWidth) / 2f;</span>
<span class="nc" id="L119">            float textY = panelY + textHeight / 2f;</span>

<span class="nc" id="L121">            game.font.setColor(Color.BLACK);</span>
<span class="nc" id="L122">            game.font.draw(game.batch, layout, textX, textY);</span>
        }
<span class="nc" id="L124">    }</span>

    @Override
    public void dispose() {
<span class="pc bpc" id="L128" title="1 of 2 branches missed.">        if (texture != null) texture.dispose();</span>
<span class="pc bpc" id="L129" title="1 of 2 branches missed.">        if (hidden_texture != null) hidden_texture.dispose();</span>
<span class="pc bpc" id="L130" title="1 of 2 branches missed.">        if (speech_panel_texture != null) speech_panel_texture.dispose();</span>
<span class="fc" id="L131">    }</span>

    // getters and setters

    /**
     * Used for testing purposes.
     * @return event type.
     */
    public HiddenEventType getType() {
<span class="nc" id="L140">        return type;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>